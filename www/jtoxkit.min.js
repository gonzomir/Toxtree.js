var ccLib={extendArray:function(base,arr){if(base===undefined||base==null)
base=[];else if(!jQuery.isArray(base))
base=[base];if(arr!==undefined&&arr!==null){for(var i=0,al=arr.length;i<al;++i){var v=arr[i];if(base.indexOf(v)<0&&v!==undefined&&v!=null)
base.push(v);}}
return base;},fireCallback:function(callback,self){if(typeof callback!='function')
callback=window[callback];return(typeof callback=='function')?(callback.apply((self!==undefined&&self!=null)?self:document,Array.prototype.slice.call(arguments,2))):null;},setObjValue:function(obj,value){if((value===undefined||value===null)&&jQuery(obj).data('default')!==undefined)
value=jQuery(obj).data('default');if(obj.nodeName=="INPUT"||obj.nodeName=="SELECT")
obj.value=value;else if(obj.nodeName=="IMG")
obj.src=value;else if(obj.nodeName=="BUTTON")
jQuery(obj).data('value',value);else
obj.innerHTML=value;},isNull:function(obj){return obj===undefined||obj==null;},isEmpty:function(obj){var empty=true;if(obj!==undefined||obj!=null){if(typeof obj=='object'){for(var i in obj){if(obj[i]!=null){empty=false;break;}}}
else if(typeof obj=='string')
empty=obj.trim().length==0;else if(jQuery.isArray(obj))
empty=obj.length==0;else
empty=false;}
return empty;},enumObject:function(obj,fn,idx,level){if(level==null)
level=0;if(typeof obj!="object")
fn(obj,idx,level);else if(jQuery.isArray(obj))
for(var i=0,l=obj.length;i<l;++i)
this.enumObject(obj[i],fn,i,level+1);else
for(var i in obj)
this.enumObject(obj[i],fn,i,level+1);},setJsonValue:function(json,field,val){if(field!==undefined){try{eval("json."+field+" = val");}
catch(e){;}}},getJsonValue:function(json,field){var value=undefined;if(field!==undefined){try{eval("value = json."+field);}
catch(e){;}}
return value;},fillTree:function(root,json,prefix,filter){var self=this;if(!filter)
filter='data-field';var processFn=function(el,json){var value=self.getJsonValue(json,jQuery(el).data('field'));if(value!==undefined){var format=jQuery(el).data('format');if(!!format&&(typeof window[format]=='function')){value=window[format](value,json);}
if(jQuery(el).hasClass('attribute'))
jQuery(el).attr(jQuery(el).data('attribute'),value);else
self.setObjValue(el,value);}}
if(jQuery(root).hasClass(filter))
processFn(root,json);jQuery('.'+filter,root).each(function(i){processFn(jQuery(this)[0],json);});if(prefix&&json.id!==undefined){root.id=prefix+json.id;}},prepareForm:function(form){var self=this;var $=window.jQuery;$('.accumulate',form).each(function(){$(this).on('change',function(e){var target=$(this).data('accumulate');if(!!target){target=this.form[target];var val=target.value.replace(new RegExp('('+this.value+')'),'');if(this.checked)
val+=','+this.value;target.value=val.replace(/,,/g,',').replace(/^,/g,'').replace(/,$/g,'');}
return false;})});},validateForm:function(form,callback){var self=this;var ok=true;jQuery('.validate',form).each(function(){if(!self.fireCallback(callback,this))
ok=false;});return ok;},clearChildren:function(obj,last){while(obj.lastChild&&obj.lastChild!=last){obj.removeChild(obj.lastChild);}},formatString:function(format,pars){for(var i in pars)
format=format.replace('{'+i+'}',pars[i]);return format;},trim:function(obj){if(obj===undefined||obj==null)
return'';if(typeof obj=="string")
return obj.trim();else
return obj;},copyToClipboard:function(text,prompt){if(!prompt){prompt="Press Ctrl-C (Command-C) to copy and then Enter.";}
window.prompt(prompt,text);},equalizeHeights:function(){var tabs=[];for(var i=0;i<arguments.length;++i){tabs[i]=arguments[i].firstElementChild;}
for(;;){var height=0;for(i=0;i<tabs.length;++i){if(tabs[i]==null)
continue;if(!jQuery(tabs[i]).hasClass('lock-height')&&tabs[i].style.height!='')
tabs[i].style.height="auto";if(tabs[i].offsetHeight>height)
height=tabs[i].offsetHeight;}
if(height==0)
break;for(i=0;i<tabs.length;++i){if(tabs[i]!=null){jQuery(tabs[i]).height(height);tabs[i]=tabs[i].nextElementSibling;}}}},addParameter:function(url,param){return url+(("&?".indexOf(url.charAt(url.length-1))==-1)?(url.indexOf('?')>0?"&":"?"):'')+param;},removeParameter:function(url,param){return url.replace(new RegExp('(.*\?.*)('+param+'=[^\&\s$]*\&?)(.*)'),'$1$3');},parseURL:function(url){var a=document.createElement('a');a.href=url;return{source:url,protocol:a.protocol.replace(':',''),host:a.hostname,port:a.port,query:a.search,params:(function(){var ret={},seg=a.search.replace(/^\?/,'').split('&'),len=seg.length,i=0,s,v,arr;for(;i<len;i++){if(!seg[i]){continue;}
s=seg[i].split('=');v=(s.length>1)?decodeURIComponent(s[1].replace(/\+/g," ")):'';if(s[0].indexOf('[]')==s[0].length-2){arr=ret[s[0].slice(0,-2)];if(arr===undefined)
ret[s[0].slice(0,-2)]=[v];else
arr.push(v);}
else
ret[s[0]]=v;}
return ret;})(),file:(a.pathname.match(/\/([^\/?#]+)$/i)||[,''])[1],hash:a.hash.replace('#',''),path:a.pathname.replace(/^([^\/])/,'/$1'),relative:(a.href.match(/tps?:\/\/[^\/]+(.+)/)||[,''])[1],segments:a.pathname.replace(/^\//,'').split('/')};}};function ccNonEmptyFilter(v){return v!==undefined&&v!=null&&v!='';}
var jToxQuery=(function(){var defaultSettings={scanDom:true,initialQuery:false,dom:{kit:null,widgets:{},},configuration:{handlers:{query:function(el,query){query.query();},}}};var cls=function(root,settings){var self=this;self.rootElement=root;jT.$(root).addClass('jtox-toolkit');self.settings=jT.$.extend(true,{},defaultSettings,jT.settings,settings);self.mainKit=null;if(self.settings.scanDom){jT.$('.jtox-toolkit',self.rootElement).each(function(){if(jT.$(this).hasClass('jtox-widget'))
self.settings.dom.widgets[jT.$(this).data('kit')]=this;else
self.settings.dom.kit=this;});}
self.initHandlers();if(!!self.settings.initialQuery)
setTimeout(function(){self.query();},200);};cls.prototype={addHandlers:function(handlers){self.settings.configuration.handlers=jT.$.extend(self.settings.configuration.handlers,handlers);},widget:function(name){return this.settings.dom.widgets[name];},kit:function(){if(!this.mainKit)
this.mainKit=jT.kit(this.settings.dom.kit);return this.mainKit;},initHandlers:function(){var self=this;var fireHandler=function(e){var handler=self.settings.configuration.handlers[jT.$(this).data('handler')];if(!!handler)
ccLib.fireCallback(handler,this,this,self);else
console.log("jToxQuery: referring unknown handler: "+jT.$(this).data('handler'));};jT.$(document).on('change','.jtox-handler',fireHandler);jT.$(document).on('click','button.jtox-handler',fireHandler);},query:function(){var uri=this.settings.service||'';for(var w in this.settings.dom.widgets){var widget=jT.kit(this.settings.dom.widgets[w]);if(!widget)
console.log("jToxError: the widget ["+w+"] is not recognized: ignored");else if(!widget['modifyUri'])
console.log("jToxError: the widget ["+w+"] doesn't have 'modifyUri' method: ignored");else
uri=widget.modifyUri(uri);}
if(!!uri)
this.kit().query(uri);}};return cls;})();var jToxSearch=(function(){var defaultSettings={defaultSmiles:'50-00-0',smartsList:'funcgroups',configuration:{handlers:{}}};var queries={'auto':"/query/compound/search/all",'url':"/query/compound/url/all",'similarity':"/query/similarity",'smarts':"/query/smarts"};var cls=function(root,settings){var self=this;self.rootElement=root;jT.$(root).addClass('jtox-toolkit');self.settings=jT.$.extend({},defaultSettings,jT.settings,settings);self.rootElement.appendChild(jT.getTemplate('#jtox-search'));self.queryKit=jT.parentKit(jToxQuery,self.rootElement);self.search={mol:"",type:""};var form=jT.$('form',self.rootElement)[0];form.onsubmit=function(){return false;}
var radios=jT.$('.jq-buttonset',root).buttonset();var onTypeClicked=function(){form.searchbox.placeholder=jT.$(this).data('placeholder');jT.$('.search-pane .dynamic').addClass('hidden');jT.$('.search-pane .'+this.id).removeClass('hidden');};jT.$('.jq-buttonset input',root).on('change',onTypeClicked);ccLib.fireCallback(onTypeClicked,jT.$('.jq-buttonset input',root)[0]);jT.$(form.searchbox)
.on('focus',function(){var gap=jT.$(form).width()-jT.$(radios).width()-30-jT.$('.search-pane').width();var oldSize=$(this).width();jT.$(this).css('width',''+(oldSize+gap)+'px');})
.on('blur',function(){jT.$(this).css('width','');})
.on('change',function(){if(this.value.indexOf('http')>-1)
self.setURL();else
self.setAuto();});if(!!window[self.settings.smartsList]){var list=window[self.settings.smartsList];var familyList=[];var familyIdx={};for(var i=0,sl=list.length;i<sl;++i){var entry=list[i];if(familyIdx[entry.family]===undefined){familyIdx[entry.family]=familyList.length;familyList.push([]);}
familyList[familyIdx[entry.family]].push(entry);}
var df=document.createDocumentFragment();for(fi=0,fl=familyList.length;fi<fl;++fi){var grp=document.createElement('optgroup');grp.label=familyList[fi][0].family;for(i=0,el=familyList[fi].length;i<el;++i){var e=familyList[fi][i];var opt=document.createElement('option');opt.innerHTML=e.name;opt.value=e.smarts;if(!!e.hint)
jT.$(opt).attr('data-hint',e.hint);grp.appendChild(opt);}
df.appendChild(grp);}
form.smarts.appendChild(df);form.smarts.firstElementChild.checked=true;jT.$(form.smarts).on('change',function(){var hint=jT.$(this[this.selectedIndex]).data('hint');form.smarts.title=(!!hint?hint:'');self.setAuto(this.value);});}
var ketcherBox=jT.$('.ketcher',root)[0];var ketcherReady=false;var onKetcher=function(service,method,async,parameters,onready){if(service=="knocknock")
onready("You are welcome!",null);else
jT.call(self.queryKit.kit(),'/ui/'+service,{dataType:"text",data:parameters},function(res,jhr){onready(res,jhr);});};var ensureKetcher=function(){if(!ketcherReady){jT.insertTool('ketcher',ketcherBox);ketcher.init({root:ketcherBox,ajaxRequest:onKetcher});var emptySpace=jT.$('.toolEmptyCell',ketcherBox)[0];jT.$(emptySpace.appendChild(jT.getTemplate('#ketcher-usebutton'))).on('click',function(){var smiles=ketcher.getSmiles();var mol=ketcher.getMolfile();self.setMol(mol);if(!!smiles)
form.searchbox.value=smiles;});jT.$(emptySpace.appendChild(jT.getTemplate('#ketcher-drawbutton'))).on('click',function(){ketcher.setMolecule(self.search.mol||form.searchbox.value);});ketcherReady=true;}};jT.$(form.drawbutton).on('click',function(){if(jT.$(ketcherBox).hasClass('shrinken')){ensureKetcher();jT.$(ketcherBox).css('display','');}
else
setTimeout(function(){jT.$(ketcherBox).css('display','none');},500);setTimeout(function(){jT.$(ketcherBox).toggleClass('shrinken')},50);});if(!!self.settings.b64search){self.setMol($.base64.decode(self.settings.b64search));}
else if(!!self.settings.search){if(self.settings.search.indexOf('http')>-1)
self.setURL(self.settings.search);else
self.setAuto(self.settings.search);}};cls.prototype={modifyUri:function(uri){var form=jT.$('form',this.rootElement)[0];var params={type:this.search.type};var type=jT.$('input[name="searchtype"]:checked',form).val();if(type=="auto"&&params.type=='url')
type="url";var res=queries[type]+(uri.indexOf('?')>-1?'':'?')+uri;if(!!this.search.mol){params.b64search=$.base64.encode(this.search.mol);}
else{params.search=form.searchbox.value;if(!params.search)
params.search=this.settings.defaultSmiles;this.setAuto(params.search);}
if(type=='similarity')
params.threshold=form.threshold.value;return ccLib.addParameter(res,$.param(params));},makeQuery:function(needle){if(!!needle)
this.setAuto(needle);this.queryKit.query();},getNeedle:function(){return this.search.type=='mol'?this.search.mol:jT.$('form',this.rootElement)[0].searchbox.value;},setAuto:function(needle){this.search.mol=null;this.search.type='auto';var box=jT.$('form',this.rootElement)[0].searchbox;if(!!this.search.oldplace)
box.placeholder=this.search.oldplace;if(needle!=null)
box.value=needle;},setMol:function(mol){var box=jT.$('form',this.rootElement)[0].searchbox;this.search.mol=mol;this.search.type='mol';this.search.oldplace=box.placeholder;box.placeholder="MOL formula saved_";box.value='';},setURL:function(url){this.search.mol=null;this.search.type='url';var box=jT.$('form',this.rootElement)[0].searchbox;if(!!this.search.oldplace)
box.placeholder=this.search.oldplace;if(url!=null)
box.value=url;}};return cls;})();var jToxCompound=(function(){var defaultSettings={"showTabs":true,"showExport":true,"showControls":true,"hideEmpty":false,"hasDetails":true,"pageSize":20,"pageStart":0,"rememberChecks":false,"metricFeature":"http://www.opentox.org/api/1.1#Similarity","onReady":null,"fnAccumulate":function(fId,oldVal,newVal,features){if(ccLib.isNull(newVal))
return oldVal;newVal=newVal.toString();if(ccLib.isNull(oldVal)||newVal.toLowerCase().indexOf(oldVal.toLowerCase())>=0)
return newVal;if(oldVal.toLowerCase().indexOf(newVal.toLowerCase())>=0)
return oldVal;return oldVal+", "+newVal;},"configuration":{"groups":{"Identifiers":["http://www.opentox.org/api/1.1#Diagram","http://www.opentox.org/api/1.1#CASRN","http://www.opentox.org/api/1.1#EINECS","http://www.opentox.org/api/1.1#IUCLID5_UUID"],"Names":["http://www.opentox.org/api/1.1#ChemicalName","http://www.opentox.org/api/1.1#TradeName","http://www.opentox.org/api/1.1#IUPACName","http://www.opentox.org/api/1.1#SMILES","http://www.opentox.org/api/1.1#InChIKey","http://www.opentox.org/api/1.1#InChI","http://www.opentox.org/api/1.1#REACHRegistrationDate"],"Calculated":function(name,miniset){var arr=[];if(miniset.dataEntry.length>0&&!ccLib.isNull(miniset.dataEntry[0].compound.metric))
arr.push(this.settings.metricFeature);for(var f in miniset.features){var feat=miniset.features[f];if(ccLib.isNull(feat.source)||ccLib.isNull(feat.source.type)||!!feat.basic)
continue;else if(feat.source.type.toLowerCase()=="algorithm"||feat.source.type.toLowerCase()=="model"){arr.push(f);}}
return arr;},"Other":function(name,miniset){var arr=[];for(var f in miniset.features){if(!miniset.features[f].used&&!miniset.features[f].basic)
arr.push(f);}
return arr;}},"exports":[{type:"chemical/x-mdl-sdfile",icon:"images/sdf64.png"},{type:"chemical/x-cml",icon:"images/cml64.png"},{type:"chemical/x-daylight-smiles",icon:"images/smi64.png"},{type:"chemical/x-inchi",icon:"images/inchi64.png"},{type:"text/uri-list",icon:"images/lnk64.png"},{type:"application/pdf",icon:"images/pdf64.png"},{type:"text/csv",icon:"images/csv64.png"},{type:"text/plain",icon:"images/txt64.png"},{type:"text/x-arff",icon:"images/arff.png"},{type:"text/x-arff-3col",icon:"images/arff-3.png"},{type:"application/rdf+xml",icon:"images/rdf64.png"},{type:"application/json",icon:"images/json64.png"}],"baseFeatures":{"http://www.opentox.org/api/1.1#Diagram":{title:"Diagram",search:false,process:function(entry,fId,features){entry.compound.diagramUri=entry.compound.URI.replace(/(.+)(\/conformer.*)/,"$1")+"?media=image/png";},render:function(col,fId){col["mData"]="compound.diagramUri";col["mRender"]=function(data,type,full){return(type!="display")?"-":'<a target="_blank" href="'+full.compound.URI+'"><img src="'+data+'" class="jtox-ds-smalldiagram"/></a>';};col["sClass"]="paddingless";col["sWidth"]="125px";return col;},visibility:"main"},"http://www.opentox.org/api/1.1#Similarity":{title:"Similarity",location:"compound.metric",search:true,used:true},}}};var baseFeatures={"http://www.opentox.org/api/1.1#REACHRegistrationDate":{title:"REACH Date",location:"compound.reachdate",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#CASRN":{title:"CAS",location:"compound.cas",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#ChemicalName":{title:"Name",location:"compound.name",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#TradeName":{title:"Trade Name",location:"compound.tradename",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#IUPACName":{title:"IUPAC Name",location:["compound.name","compound.iupac"],accumulate:true,basic:true},"http://www.opentox.org/api/1.1#EINECS":{title:"EINECS",location:"compound.einecs",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#InChI":{title:"InChI",location:"compound.inchi",shorten:true,accumulate:true,basic:true},"http://www.opentox.org/api/1.1#InChI_std":{title:"InChI",location:"compound.inchi",shorten:true,accumulate:true,used:true,basic:true},"http://www.opentox.org/api/1.1#InChIKey":{title:"InChI Key",location:"compound.inchikey",accumulate:true,basic:true},"http://www.opentox.org/api/1.1#InChIKey_std":{title:"InChI Key",location:"compound.inchikey",accumulate:true,used:true,basic:true},"http://www.opentox.org/api/1.1#InChI_AuxInfo":{title:"InChI Aux",location:"compound.inchi",accumulate:true,used:true,basic:true},"http://www.opentox.org/api/1.1#InChI_AuxInfo_std":{title:"InChI Aux",location:"compound.inchi",accumulate:true,used:true,basic:true},"http://www.opentox.org/api/1.1#IUCLID5_UUID":{title:"IUCLID5 UUID",location:"compound.i5uuid",shorten:true,accumulate:true,basic:true},"http://www.opentox.org/api/1.1#SMILES":{title:"SMILES",location:"compound.smiles",shorten:true,accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#CMS":{title:"CMS",accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#ChEBI":{title:"ChEBI",accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#Pubchem":{title:"PubChem",accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#ChemSpider":{title:"ChemSpider",accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#ChEMBL":{title:"ChEMBL",accumulate:true,basic:true},"http://www.opentox.org/api/dblinks#ToxbankWiki":{title:"Toxbank Wiki",accumulate:true,basic:true},};var instanceCount=0;var cls=function(root,settings){var self=this;self.rootElement=root;jT.$(root).addClass('jtox-toolkit');var newDefs=jT.$.extend(true,{"configuration":{"baseFeatures":baseFeatures}},defaultSettings);self.settings=jT.$.extend(true,{},newDefs,jT.settings,settings);self.instanceNo=instanceCount++;if(self.settings.rememberChecks&&self.settings.showTabs)
self.featureStates={};if(self.settings['datasetUri']!==undefined){self.queryDataset(self.settings['datasetUri']);}};cls.prototype={init:function(){var self=this;self.features=null;self.dataset=null;self.groups=null;self.fixTable=self.varTable=null;self.entriesCount=null;self.suspendEqualization=false;self.orderList=[];self.usedFeatures=[];self.rootElement.appendChild(jT.getTemplate('#jtox-compound'));var pane=jT.$('.jtox-ds-control',self.rootElement)[0];if(self.settings.showControls){ccLib.fillTree(pane,{"pagesize":self.settings.pageSize});jT.$('.next-field',pane).on('click',function(){self.nextPage();});jT.$('.prev-field',pane).on('click',function(){self.prevPage();});jT.$('select',pane).on('change',function(){self.queryEntries(self.settings.pageStart,parseInt(jT.$(this).val()));})
var pressTimeout=null;jT.$('input',pane).on('keydown',function(){if(pressTimeout!=null)
clearTimeout(pressTimeout);pressTimeout=setTimeout(function(){self.updateTables();},350);});}
else
pane.style.display="none";},clearDataset:function(){if(this.usedFeatures!==undefined){jT.$(this.rootElement).empty();for(var i=0,fl=this.usedFeatures.length;i<fl;++i){var fid=this.usedFeatures[i];this.features[fid].used=false;}}},prepareTabs:function(root,isMain,nodeFn,divFn){var self=this;var all=document.createElement('div');all.style.display="none";root.appendChild(all);ulEl=document.createElement('ul');all.appendChild(ulEl);var createATab=function(grId,name){var liEl=document.createElement('li');ulEl.appendChild(liEl);var aEl=document.createElement('a');aEl.href="#"+grId;aEl.innerHTML=name;liEl.appendChild(aEl);return liEl;};var emptyList=[];var idx=0;for(var gr in self.groups){var grId="jtox-ds-"+gr.replace(/\s/g,"_")+"-"+self.instanceNo;var tabLi=createATab(grId,gr.replace(/_/g," "));var divEl=document.createElement('div');divEl.id=grId;all.appendChild(divEl);if(typeof divFn=='function')
divEl=divFn(gr,divEl);var grp=self.groups[gr];var empty=true;ccLib.enumObject(self.groups[gr],function(fId,idx,level){var vis=(self.features[fId]||{})['visibility'];if(!!vis&&(vis=="none"||(!isMain&&vis=='main')||(isMain&&vis=="details")))
return;empty=false;if(idx=="name"){if(isMain){var fEl=nodeFn(null,fId,divEl);if(self.settings.rememberChecks)
jT.$('input[type="checkbox"]',fEl)[0].checked=(self.featureStates[fId]===undefined||self.featureStates[fId]);}}
else if(!isMain||level==1){var title=self.features[fId].title;if(!ccLib.isNull(title)){var fEl=nodeFn(fId,title,divEl);if(isMain&&self.settings.rememberChecks)
jT.$('input[type="checkbox"]',fEl)[0].checked=(self.featureStates[fId]===undefined||self.featureStates[fId]);}}});if(empty){if(self.settings.hideEmpty){jT.$(divEl).remove();jT.$(tabLi).remove();--idx;}
else
emptyList.push(idx);}
++idx;}
if(isMain&&self.settings.showExport){var tabId="jtox-ds-export-"+self.instanceNo;var liEl=createATab(tabId,"Export");jT.$(liEl).addClass('jtox-ds-export');var divEl=jT.getTemplate('#jtox-ds-export')
divEl.id=tabId;all.appendChild(divEl);divEl=jT.$('.jtox-exportlist',divEl)[0];for(var i=0,elen=self.settings.configuration.exports.length;i<elen;++i){var expo=self.settings.configuration.exports[i];var el=jT.getTemplate('#jtox-ds-download');divEl.appendChild(el);jT.$('a',el)[0].href=ccLib.addParameter(self.datasetUri,"media="+encodeURIComponent(expo.type));var img=el.getElementsByTagName('img')[0];img.alt=img.title=expo.type;img.src=(jT.settings.baseUrl||self.settings.baseUrl)+'/'+expo.icon;}}
all.style.display="block";return jT.$(all).tabs({collapsible:isMain,disabled:emptyList,heightStyle:isMain?"content":"fill"});},equalizeTables:function(){var self=this;if(!self.suspendEqualization&&self.fixTable!=null&&self.varTable!=null){ccLib.equalizeHeights(self.fixTable.tHead,self.varTable.tHead);ccLib.equalizeHeights(self.fixTable.tBodies[0],self.varTable.tBodies[0]);}},featureValue:function(fId,data){var self=this;var feature=self.features[fId];if(feature.location!==undefined)
return ccLib.getJsonValue(data,jT.$.isArray(feature.location)?feature.location[0]:feature.location);else
return data.values[fId];},featureUri:function(fId){var self=this;var origId=self.features[fId].originalId;return ccLib.isNull(origId)?fId:origId;},prepareTables:function(){var self=this;var varCols=[];var fixCols=[];var colList=fixCols;fixCols.push({"mData":"number","sClass":"middle","mRender":function(data,type,full){return(type!="display")?''+data:"&nbsp;-&nbsp;"+data+"&nbsp;-&nbsp;<br/>"+
(self.settings.hasDetails?'<span class="jtox-details-open ui-icon ui-icon-circle-triangle-e" title="Press to open/close detailed info for the entry"></span>':'');}},{"sClass":"jtox-hidden","mData":"index","sDefaultContent":"-","bSortable":true,"mRender":function(data,type,full){return ccLib.isNull(self.orderList)?0:self.orderList[data];}},{"sClass":"jtox-hidden jtox-ds-details paddingless","mData":"index","sDefaultContent":"-","mRender":function(data,type,full){return'';}});varCols.push({"sClass":"jtox-hidden jtox-ds-details paddingless","mData":"index","mRender":function(data,type,full){return'';}});var fnShowColumn=function(){var dt=$(this).data();var cells=jT.$(dt.sel+' table tr>*:nth-child('+(dt.idx+1)+')',self.rootElement);if(this.checked)
jT.$(cells).show();else
jT.$(cells).hide();if(self.settings.rememberChecks)
self.featureStates[dt.id]=this.checked;self.equalizeTables();};var fnExpandCell=function(cell,expand){var cnt=0;for(var c=cell;c;c=c.nextElementSibling,++cnt)
jT.$(c).toggleClass('jtox-hidden');if(expand)
cell.setAttribute('colspan',''+cnt);else
cell.removeAttribute('colspan');};var fnShowDetails=(self.settings.hasDetails?function(row){var cell=jT.$(".jtox-ds-details",row)[0];var idx=jT.$(row).data('jtox-index');jT.$(row).toggleClass('jtox-detailed-row');var toShow=jT.$(row).hasClass('jtox-detailed-row');fnExpandCell(cell,toShow);var varCell=document.getElementById('jtox-var-'+self.instanceNo+'-'+idx).firstElementChild;fnExpandCell(varCell,toShow);var iconCell=jT.$('.jtox-details-open',row);jT.$(iconCell).toggleClass('ui-icon-circle-triangle-e');jT.$(iconCell).toggleClass('ui-icon-circle-triangle-w');if(toShow){var full=self.dataset.dataEntry[idx];var detDiv=document.createElement('div');varCell.appendChild(detDiv);var img=new Image();img.onload=function(e){self.equalizeTables();jT.$(detDiv).height(varCell.parentNode.clientHeight-1);self.prepareTabs(detDiv,false,function(id,name,parent){var fEl=null;if(id!=null){fEl=jT.getTemplate('#jtox-one-detail');parent.appendChild(fEl);ccLib.fillTree(fEl,{title:name,value:self.featureValue(id,full),uri:self.featureUri(id)});}
return fEl;},function(id,parent){var tabTable=jT.getTemplate('#jtox-details-table');parent.appendChild(tabTable);return tabTable;});};img.src=full.compound.diagramUri;cell.appendChild(img);}
else{jT.$(cell).empty();jT.$(varCell).empty();self.equalizeTables();}}:null);var checkList=jT.$('.jtox-ds-features .jtox-checkbox',self.rootElement);var checkIdx=-1;for(var gr in self.groups){ccLib.enumObject(self.groups[gr],function(fId,idx,level){if(idx=="name"){++checkIdx;return;}
var feature=self.features[fId];var col={"sTitle":feature.title.replace(/_/g,' ')+(ccLib.isNull(feature.units)?"":feature.units),"sDefaultContent":"-",};if(feature.location!==undefined)
col["mData"]=feature.location;else{col["mData"]='values';col["mRender"]=(function(featureId){return function(data,type,full){var val=data[featureId];return ccLib.isEmpty(val)?'-':val};})(fId);}
if(feature.render!==undefined)
col=ccLib.fireCallback(feature.render,self,col,fId);if(!!feature.shorten){col["mRender"]=function(data,type,full){return(type!="display")?''+data:jT.shortenedData(data,"Press to copy the value in the clipboard");};col["sWidth"]="75px";}
if(level==1)
++checkIdx;jT.$(checkList[checkIdx]).data({sel:colList==fixCols?'.jtox-ds-fixed':'.jtox-ds-variable',idx:colList.length,id:fId}).on('change',fnShowColumn)
colList.push(col);});colList=varCols;}
self.fixTable=(jT.$(".jtox-ds-fixed table",self.rootElement).dataTable({"bPaginate":false,"bProcessing":true,"bLengthChange":false,"bAutoWidth":true,"sDom":"rt","aoColumns":fixCols,"bSort":false,"fnCreatedRow":function(nRow,aData,iDataIndex){if(self.settings.hasDetails)
jT.$('.jtox-details-open',nRow).on('click',function(e){fnShowDetails(nRow);});jT.$(nRow).data('jtox-index',iDataIndex);},"oLanguage":{"sEmptyTable":'<span id="jtox-ds-message-'+self.instanceNo+'">Loading data...</span>',}}))[0];self.varTable=(jT.$(".jtox-ds-variable table",self.rootElement).dataTable({"bPaginate":false,"bLengthChange":false,"bAutoWidth":false,"sDom":"rt","bSort":true,"aoColumns":varCols,"bScrollCollapse":true,"fnCreatedRow":function(nRow,aData,iDataIndex){nRow.id='jtox-var-'+self.instanceNo+'-'+iDataIndex;jT.$(nRow).addClass('jtox-row');jT.$(nRow).data('jtox-index',iDataIndex);},"fnDrawCallback":function(oSettings){var sorted=jT.$('.jtox-row',this);for(var i=0,rlen=sorted.length;i<rlen;++i){var idx=jT.$(sorted[i]).data('jtox-index');self.orderList[idx]=i;}
if(rlen>0)
jT.$(self.fixTable).dataTable().fnSort([[1,"asc"]]);},"oLanguage":{"sEmptyTable":" - "}}))[0];},updateTables:function(){var self=this;self.filterEntries(jT.$('.jtox-ds-control input',self.rootElement).val());},prepareGroups:function(miniset){var self=this;var grps=self.settings.configuration.groups;self.groups={};for(var i in grps){var grp=grps[i];if(ccLib.isNull(grp))
continue;var grpArr=(typeof grp=="function"||typeof grp=="string")?ccLib.fireCallback(grp,self,i,miniset):grp;self.groups[i]=[];ccLib.enumObject(grpArr,function(fid,idx){var sameAs=cls.findSameAs(fid,self.features);if(!self.features[sameAs].used&&!self.features[fid].used)
self.groups[i].push(fid);if(idx!="name"){self.usedFeatures.push(fid);self.usedFeatures.push(sameAs);self.features[fid].used=self.features[sameAs].used=true;}});}},enumerateFeatures:function(fnMatch){var self=this;var stopped=false;for(var gr in self.groups){for(var i=0,glen=self.groups[gr].length;i<glen;++i){if(stopped=fnMatch(self.groups[gr][i],gr))
break;}
if(stopped)
break;}
return stopped;},filterEntries:function(needle){var self=this;if(ccLib.isNull(needle))
needle='';else
needle=needle.toLowerCase();var dataFeed=[];if(needle!=''){for(var i=0,slen=self.dataset.dataEntry.length;i<slen;++i){var entry=self.dataset.dataEntry[i];var match=self.enumerateFeatures(function(fId,gr){var feat=self.features[fId];if(feat.search!==undefined&&!feat.search)
return false;var val=self.featureValue(fId,entry);return!ccLib.isNull(val)&&val.toString().toLowerCase().indexOf(needle)>=0;});if(match)
dataFeed.push(entry);}}
else{dataFeed=self.dataset.dataEntry;}
jT.$(self.fixTable).dataTable().fnClearTable();jT.$(self.varTable).dataTable().fnClearTable();jT.$(self.fixTable).dataTable().fnAddData(dataFeed);jT.$(self.varTable).dataTable().fnAddData(dataFeed);jT.$('#jtox-ds-message-'+self.instanceNo).html('No records matching the filter.');if(self.settings.showTabs){self.suspendEqualization=true;jT.$('.jtox-ds-features .jtox-checkbox',self.rootElement).trigger('change');self.suspendEqualization=false;}
self.equalizeTables();},nextPage:function(){var self=this;if(self.entriesCount===null||self.settings.pageStart+self.settings.pageSize<self.entriesCount)
self.queryEntries(self.settings.pageStart+self.settings.pageSize);},prevPage:function(){var self=this;if(self.settings.pageStart>0)
self.queryEntries(self.settings.pageStart-self.settings.pageSize);},queryEntries:function(from,size,fnComplete){var self=this;if(from<0)
from=0;if(size==null)
size=self.settings.pageSize;jT.$('.jtox-ds-control select',self.rootElement).val(size);self.settings.pageSize=size;var qStart=Math.floor(from/size);var qUri=ccLib.addParameter(self.datasetUri,"page="+qStart+"&pagesize="+size);jT.call(self,qUri,function(dataset){if(!!dataset){var qSize=dataset.dataEntry.length;qStart=self.settings.pageStart=qStart*self.settings.pageSize;if(qSize<self.settings.pageSize)
self.entriesCount=qStart+qSize;self.dataset=cls.processDataset(dataset,self.features,self.settings.fnAccumulate,self.settings.pageStart);self.updateTables();if(self.settings.showControls){var pane=jT.$('.jtox-ds-control',self.rootElement)[0];ccLib.fillTree(pane,{"pagestart":qStart+1,"pageend":qStart+qSize,});var nextBut=jT.$('.next-field',pane);if(self.entriesCount===null||qStart+qSize<self.entriesCount)
jT.$(nextBut).addClass('paginate_enabled_next').removeClass('paginate_disabled_next');else
jT.$(nextBut).addClass('paginate_disabled_next').removeClass('paginate_enabled_next');var prevBut=jT.$('.prev-field',pane);if(qStart>0)
jT.$(prevBut).addClass('paginate_enabled_previous').removeClass('paginate_disabled_previous');else
jT.$(prevBut).addClass('paginate_disabled_previous').removeClass('paginate_enabled_previous');}
ccLib.fireCallback(self.settings.onReady,self,dataset);if(typeof fnComplete=='function')
fnComplete();}});},queryDataset:function(datasetUri){var self=this;this.clearDataset();this.init();var urlObj=ccLib.parseURL(datasetUri);if(urlObj.params['pagesize']!==undefined){var sz=parseInt(urlObj.params['pagesize']);if(sz>0)
self.settings.pageSize=sz;datasetUri=ccLib.removeParameter(datasetUri,'pagesize');}
if(urlObj.params['page']!==undefined){var beg=parseInt(urlObj.params['page']);if(beg>=0)
self.settings.pageStart=beg*self.settings.pageSize;datasetUri=ccLib.removeParameter(datasetUri,'page');}
self.settings.baseUrl=self.settings.baseUrl||jT.grabBaseUrl(datasetUri);self.datasetUri=datasetUri;jT.call(self,ccLib.addParameter(datasetUri,"page=0&pagesize=1"),function(dataset){if(!!dataset){self.features=dataset.feature;cls.processFeatures(self.features,self.settings.configuration.baseFeatures);dataset.features=self.features;self.prepareGroups(dataset);if(self.settings.showTabs){self.prepareTabs(jT.$('.jtox-ds-features',self.rootElement)[0],true,function(id,name,parent){var fEl=jT.getTemplate('#jtox-ds-feature');parent.appendChild(fEl);ccLib.fillTree(fEl,{title:name.replace(/_/g,' '),uri:self.featureUri(id)});return fEl;});}
self.prepareTables();self.equalizeTables();self.queryEntries(self.settings.pageStart,self.settings.pageSize);}});},query:function(uri){this.queryDataset(uri);}};cls.processEntry=function(entry,features,fnValue){for(var fid in features){var feature=features[fid];var newVal=entry.values[fid];if(!!feature.accumulate&&newVal!==undefined&&feature.location!==undefined){var accArr=feature.location;if(!jT.$.isArray(accArr))
accArr=[accArr];for(var v=0;v<accArr.length;++v)
ccLib.setJsonValue(entry,accArr[v],ccLib.fireCallback(fnValue,this,fid,ccLib.getJsonValue(entry,accArr[v]),newVal,features));}
if(feature.process!==undefined)
ccLib.fireCallback(feature.process,this,entry,fid,features);}
return entry;};cls.findSameAs=function(fid,features){var feature=features[fid];var base=fid.replace(/(http.+\/feature\/).*/g,"$1");var retId=fid;for(;;){if(feature.sameAs===undefined||feature.sameAs==null||feature.sameAs==fid||fid==base+feature.sameAs)
break;if(features[feature.sameAs]!==undefined)
retId=feature.sameAs;else{if(features[base+feature.sameAs]!==undefined)
retId=base+feature.sameAs;else
break;}
feature=features[retId];}
return retId;};cls.processFeatures=function(features,bases){if(bases==null)
bases=baseFeatures;features=jT.$.extend(features,bases);for(var fid in features){var sameAs=cls.findSameAs(fid,features);features[fid]=jT.$.extend(features[fid],features[sameAs],{originalId:fid,originalTitle:features[fid].title});}
return features;};cls.processDataset=function(dataset,features,fnValue,startIdx){if(ccLib.isNull(features)){cls.processFeatures(dataset.feature);features=dataset.feature;}
if(ccLib.isNull(fnValue))
fnValue=cls.defaultSettings.fnAccumuate;if(!startIdx)
startIdx=0;for(var i=0,dl=dataset.dataEntry.length;i<dl;++i){cls.processEntry(dataset.dataEntry[i],features,fnValue);dataset.dataEntry[i].number=i+1+startIdx;dataset.dataEntry[i].index=i;}
return dataset;};return cls;})();var jToxDataset=(function(){var defaultSettings={shortStars:false,maxStars:10,selectable:false,selectionHandler:null,sDom:"<Fif>rt",onReady:null,configuration:{columns:{dataset:{'Id':{iOrder:0,sTitle:"Id",mData:"URI",sWidth:"50px",mRender:function(data,type,full){var num=parseInt(data.match(/http:\/\/.*\/dataset\/(\d+).*/)[1]);if(type!='display')
return num;return'<a target="_blank" href="'+data+'"><span class="ui-icon ui-icon-link jtox-inline"></span> D'+num+'</a>';}},'Title':{iOrder:1,sTitle:"Title",mData:"title",sDefaultContent:"-"},'Stars':{iOrder:2,sTitle:"Stars",mData:"stars",sWidth:"160px"},'Info':{iOrder:3,sTitle:"Info",mData:"rights",mRender:function(data,type,full){return'<a target="_blank" href="'+data.URI+'">rights</a>';}}}}}};var cls=function(root,settings){var self=this;self.rootElement=root;jT.$(root).addClass('jtox-toolkit');self.settings=jT.$.extend(true,{},defaultSettings,jT.settings,settings);self.rootElement.appendChild(jT.getTemplate('#jtox-dataset'));self.init();self.listDatasets(self.settings.listUri)};cls.prototype={init:function(){var self=this;self.settings.configuration.columns.dataset.Stars.mRender=function(data,type,full){return type!='display'?data:cls.putStars(self,data,"Dataset quality stars rating (worst) 1-10 (best)");};if(self.settings.shortStars)
self.settings.configuration.columns.dataset.Stars.sWidth="40px";if(self.settings.selectable){var oldFn=self.settings.configuration.columns.dataset.Id.mRender=cls.addSelection(self,self.settings.configuration.columns.dataset.Id.mRender);self.settings.configuration.columns.dataset.Id.sWidth="60px";}
self.table=jT.$('table',self.rootElement).dataTable({"bPaginate":false,"bLengthChange":false,"bAutoWidth":false,"sDom":self.settings.sDom,"aoColumns":jT.processColumns(self,'dataset'),"oLanguage":{"sLoadingRecords":"No datasets found.","sZeroRecords":"No datasets found.","sEmptyTable":"No datasets available.","sInfo":"Showing _TOTAL_ dataset(s) (_START_ to _END_)"}});jT.$(self.table).dataTable().fnAdjustColumnSizing();},listDatasets:function(uri){var self=this;if(uri==null)
uri=self.settings.baseUrl+'/dataset';jT.$(self.table).dataTable().fnClearTable();jT.call(self,uri,function(result){if(!!result){jT.$(self.table).dataTable().fnAddData(result.dataset);ccLib.fireCallback(self.settings.onReady,self,result);}});},query:function(uri){this.listDatasets(uri);},modifyUri:function(uri){jT.$('input[type="checkbox"]',this.rootElement).each(function(){if(this.checked)
uri=ccLib.addParameter(uri,'feature_uris[]='+encodeURIComponent(this.value+'/feature'));})
return uri;}};cls.putStars=function(kit,stars,title){if(!kit.settings.shortStars){var res='<div title="'+title+'">';for(var i=0;i<kit.settings.maxStars;++i){res+='<span class="ui-icon ui-icon-star jtox-inline';if(i>=stars)
res+=' transparent';res+='"></span>';}
return res+'</div>';}
else{return'<span class="ui-icon ui-icon-star jtox-inline" title="'+title+'"></span>'+stars;}};cls.addSelection=function(kit,oldFn){return function(data,type,full){var oldRes=oldFn(data,type,full);if(type!='display')
return oldRes;return'<input type="checkbox" value="'+(full.URI||full.uri)+'"'+
(!!kit.settings.selectionHandler?' class="jtox-handler" data-handler="'+kit.settings.selectionHandler+'"':'')+
'/>'+oldRes;}};return cls;})();var jToxModel=(function(){var defaultSettings={selectable:false,selectionHandler:null,maxStars:10,algorithmLink:true,algorithms:false,algorithmNeedle:null,onReady:null,sDom:"<Fif>rt",configuration:{columns:{model:{'Id':{iOrder:0,sTitle:"Id",mData:"id",sWidth:"50px",mRender:function(data,type,full){if(type!='display')
return data;return'<a target="_blank" href="'+full.URI+'"><span class="ui-icon ui-icon-link jtox-inline"></span> M'+data+'</a>';}},'Title':{iOrder:1,sTitle:"Title",mData:"title",sDefaultContent:"-"},'Stars':{iOrder:2,sTitle:"Stars",mData:"stars",sWidth:"160px"},'Algorithm':{iOrder:3,sTitle:"Algorithm",mData:"algorithm"},'Info':{iOrder:4,sTitle:"Info",mData:"trainingDataset",mRender:function(data,type,full){if(type!='display'||!data)
return data;return'<a href="'+data+'"><span class="ui-icon ui-icon-calculator"></span>&nbsp;training set</a>';}}},algorithm:{'Id':{iOrder:0,sTitle:"Id",mData:"id",sWidth:"150px",mRender:function(data,type,full){if(type!='display')
return data;return'<a target="_blank" href="'+full.uri+'"><span class="ui-icon ui-icon-link jtox-inline"></span> M'+data+'</a>';}},'Title':{iOrder:1,sTitle:"Title",mData:"name",sDefaultContent:"-"},'Description':{iOrder:2,sTitle:"Description",sClass:"shortened",mData:"description",sDefaultContent:'-'},'Info':{iOrder:3,sTitle:"Info",mData:"format",mRender:function(data,type,full){if(type!='display'||!data)
return data;return'<strong>'+data+'</strong>; '+
(full.isSupevised?'<strong>Supervised</strong>; ':'')+
'<a target="_blank" href="'+full.implementationOf+'">'+full.implementationOf+'</a>';}}}}}};var cls=function(root,settings){var self=this;self.rootElement=root;jT.$(root).addClass('jtox-toolkit');self.settings=jT.$.extend(true,{},defaultSettings,jT.settings,settings);self.models=null;self.rootElement.appendChild(jT.getTemplate('#jtox-model'));self.init();self.query();};cls.prototype={init:function(){var self=this;if(!self.settings.algorithms){self.settings.configuration.columns.model.Stars.mRender=function(data,type,full){return type!='display'?data:jToxDataset.putStars(self,data,"Model star rating (worst) 1 - 10 (best)");};if(self.settings.shortStars){self.settings.configuration.columns.model.Stars.sWidth="40px";}
self.settings.configuration.columns.model.Algorithm.mRender=function(data,type,full){var name=data.URI.match(/http:\/\/.*\/algorithm\/(\w+).*/)[1];if(type!='display')
return name;var res='<a target="_blank" href="'+data.URI+'">'+
'<img src="'+(self.settings.baseUrl||jT.settings.baseUrl)+data.img+'"/>&nbsp;'+
name+
'</a>';if(self.settings.algorithmLink){res+='<a href="'+ccLib.addParameter(self.modelUri,'algorithm='+encodeURIComponent(data.URI))+'"><span class="ui-icon ui-icon-calculator float-right" title="Show models using algorithm '+name+'"></span></a>';}
return res;};}
var cat=self.settings.algorithms?'algorithm':'model';if(self.settings.selectable){self.settings.configuration.columns[cat].Id.mRender=jToxDataset.addSelection(self,self.settings.configuration.columns.model.Id.mRender);self.settings.configuration.columns[cat].Id.sWidth="60px";}
self.table=jT.$('table',self.rootElement).dataTable({"bPaginate":false,"bLengthChange":false,"bAutoWidth":false,"sDom":self.settings.sDom,"aoColumns":jT.processColumns(self,cat),"oLanguage":{"sLoadingRecords":"No models found.","sZeroRecords":"No models found.","sEmptyTable":"No models available.","sInfo":"Showing _TOTAL_ model(s) (_START_ to _END_)"}});jT.$(self.table).dataTable().fnAdjustColumnSizing();},listModels:function(uri){var self=this;if(uri==null)
uri=self.settings.baseUrl+'/model';self.modelUri=uri;jT.$(self.table).dataTable().fnClearTable();jT.call(self,uri,function(result){if(!!result){self.models=result.model;jT.$(self.table).dataTable().fnAddData(result.model);ccLib.fireCallback(self.settings.onReady,self,result);}});},listAlgorithms:function(needle){var self=this;var uri=self.settings.baseUrl+'/algorithm';if(!!needle)
uri=ccLib.addParameter(uri,'search='+needle);jT.call(self,uri,function(result){if(!!result){self.algorithms=result.algorithm;jT.$(self.table).dataTable().fnAddData(result.algorithm);ccLib.fireCallback(self.settings.onReady,self,result);}});},getModel:function(algoUri,callback){},runPrediction:function(compoundUri,modelUri,callback){},query:function(uri){if(this.settings.algorithms)
this.listAlgorithms(this.settings.algorithmNeedle=(uri||this.settings.algorithmNeedle));else
this.listModels(this.settings.modelUri=(uri||this.settings.modelUri));},modifyUri:function(uri){jT.$('input[type="checkbox"]',this.rootElement).each(function(){if(this.checked)
uri=ccLib.addParameter(uri,'feature_uris[]='+encodeURIComponent(this.value+'/predicted'));})
return uri;}};return cls;})();var jToxStudy=(function(){var defaultSettings={tab:null,sDom:"rt<Fip>",configuration:{columns:{"_":{"main":{},"parameters":{},"conditions":{},"effects":{},"protocol":{},"interpretation":{},},"composition":{"main":{}}}}};var instanceCount=0;var fnDatasetValue=function(fid,old,value,features){return ccLib.extendArray(old,value!=null?value.trim().toLowerCase().split("|"):[value]).filter(ccNonEmptyFilter);};var cls=function(root,settings){var self=this;self.rootElement=root;var suffix='_'+instanceCount++;jT.$(root).addClass('jtox-toolkit');self.settings=jT.$.extend(true,{},defaultSettings,jT.settings,settings);self.settings.tab=self.settings.tab||jT.settings.fullUrl.hash;var tree=jT.getTemplate('#jtox-studies');root.appendChild(tree);jT.changeTabsIds(tree,suffix);jT.$('div.jtox-study-tab div button',tree).on('click',function(e){var par=jT.$(this).parents('.jtox-study-tab')[0];if(jT.$(this).hasClass('expand-all')){jT.$('.jtox-foldable',par).removeClass('folded');}
else if(jT.$(this).hasClass('collapse-all')){jT.$('.jtox-foldable',par).addClass('folded');}});self.tabs=jT.$(tree).tabs({"select":function(event,ui){self.loadPanel(ui.panel);},"beforeActivate":function(event,ui){if(ui.newPanel)
self.loadPanel(ui.newPanel[0]);}});if(self.settings['substanceUri']!==undefined){self.querySubstance(self.settings['substanceUri']);}};cls.prototype={loadPanel:function(panel){var self=this;if(panel){jT.$('.jtox-study.unloaded',panel).each(function(i){var table=this;jT.call(self,jT.$(table).data('jtox-uri'),function(study){if(!!study){jT.$(table).removeClass('unloaded folded');jT.$(table).addClass('loaded');self.processStudies(panel,study.study,false);}});});}},getFormatted:function(data,type,format){var value=null;if(typeof format==='function')
value=format.call(this,data,type);else if(typeof format==='string'||typeof format==='number')
value=data[format];else
value=data[0];return value;},renderMulti:function(data,type,full,format){var self=this;var dlen=data.length;if(dlen<2)
return self.getFormatted(data[0],type,format);var height=100/dlen;var df='<table>';for(var i=0,dlen=data.length;i<dlen;++i){df+='<tr class="'+(i%2==0?'even':'odd')+'"><td class="center" style="height: '+height+'%">'+self.getFormatted(data[i],type,format)+'</td></tr>';}
df+='</table>';return df;},createCategory:function(tab,category){var self=this;var theCat=jT.$('.'+category+'.jtox-study',tab)[0];if(!theCat){theCat=jT.getTemplate('#jtox-study');tab.appendChild(theCat);jT.$(theCat).addClass(category);}
return theCat;},updateCount:function(str,count){if(count===undefined)
count=0;return str.replace(/(.+)\s\(([0-9]+)\)/,"$1 ("+count+")");},ensureTable:function(tab,study){var self=this;var category=study.protocol.category.code;var theTable=jT.$('.'+category+' .jtox-study-table',tab)[0];if(!jT.$(theTable).hasClass('dataTable')){var defaultColumns=[{"sTitle":"Name","sClass":"center middle","sWidth":"20%","mData":"protocol.endpoint"},{"sTitle":"Endpoint","sClass":"center middle jtox-multi","sWidth":"15%","mData":"effects","mRender":function(data,type,full){return self.renderMulti(data,type,full,"endpoint");}},{"sTitle":"Result","sClass":"center middle jtox-multi","sWidth":"15%","mData":"effects","mRender":function(data,type,full){return self.renderMulti(data,type,full,function(data,type){return formatLoHigh(data.result,type)})}},{"sTitle":"Guideline","sClass":"center middle","sWidth":"15%","mData":"protocol.guideline","mRender":"[,]","sDefaultContent":"?"},{"sTitle":"Owner","sClass":"center middle shortened","sWidth":"15%","mData":"citation.owner","sDefaultContent":"?"},{"sTitle":"UUID","sClass":"center middle","sWidth":"15%","mData":"uuid","bSearchable":false,"mRender":function(data,type,full){return type!="display"?''+data:jT.shortenedData(data,"Press to copy the UUID in the clipboard");}}];var colDefs=[];var parCount=0;var putAGroup=function(group,fProcess){var count=0;var skip=[];for(var p in group){if(skip.indexOf(p)>-1)
continue;if(group[p+" unit"]!==undefined)
skip.push(p+" unit");var val=fProcess(p);if(ccLib.isNull(val))
continue;colDefs.push(val);count++;}
return count;}
var putDefaults=function(start,len,group){for(var i=0;i<len;++i){var col=jT.$.extend({},defaultColumns[i+start]);col=jT.modifyColDef(self,col,category,group);if(col!=null)
colDefs.push(col);}};var formatLoHigh=function(data,type){var out="";if(!ccLib.isNull(data)){data.loValue=ccLib.trim(data.loValue);data.upValue=ccLib.trim(data.upValue);if(!ccLib.isEmpty(data.loValue)&&!ccLib.isEmpty(data.upValue)){out+=(data.loQualifier==">=")?"[":"(";out+=data.loValue+", "+data.upValue;out+=(data.upQualifier=="<=")?"]":") ";}
else
{var fnFormat=function(q,v){return(!!q?q:"=")+" "+v;};if(!ccLib.isEmpty(data.loValue))
out+=fnFormat(data.loQualifier,data.loValue);else if(!ccLib.isEmpty(data.upValue))
out+=fnFormat(data.upQualifier,data.upValue);else
out+='-';}
data.unit=ccLib.trim(data.unit);if(!ccLib.isNull(data.unit))
out+=' <span class="units">'+data.unit+'</span>';}
return out.replace(/ /g,"&nbsp;").replace("span&nbsp;","span ");};var formatUnits=function(data,unit){data=ccLib.trim(data);unit=ccLib.trim(unit);return!ccLib.isNull(data)?(data+(!!unit?'&nbsp;<span class="units">'+unit+'</span>':"")):"-";};putDefaults(0,1,"main");putAGroup(study.parameters,function(p){if(study.effects[0].conditions[p]!==undefined||study.effects[0].conditions[p+" unit"]!==undefined)
return undefined;var col={"sTitle":p,"sClass":"center middle","mData":"parameters."+p,"sDefaultContent":"-"};col=jT.modifyColDef(self,col,category,"parameters");if(col==null)
return null;if(study.parameters[p]!==undefined&&study.parameters[p]!=null){col["mRender"]=study.parameters[p].loValue===undefined?function(data,type,full){return formatUnits(data,full[p+" unit"]);}:function(data,type,full){return formatLoHigh(data.parameters[p],type);};}
return col;});putAGroup(study.effects[0].conditions,function(c){var col={"sTitle":c,"sClass":"center middle jtox-multi","mData":"effects"};col=jT.modifyColDef(self,col,category,"conditions");if(col==null)
return null;var rnFn=null;if(study.effects[0].conditions[c]!==undefined&&study.effects[0].conditions[c]!=null)
rnFn=study.effects[0].conditions[c].loValue===undefined?function(data,type){return formatUnits(data.conditions[c],data.conditions[c+" unit"]);}:function(data,type){return formatLoHigh(data.conditions[c],type);}
else
rnFn=function(data,type){return"-";}
col["mRender"]=function(data,type,full){return self.renderMulti(data,type,full,rnFn);};return col;});putDefaults(1,2,"effects");putAGroup(study.interpretation,function(i){var col={"sTitle":i,"sClass":"center middle jtox-multi","mData":"interpretation."+i,"sDefaultContent":"-"};return jT.modifyColDef(self,col,category,"interpretation");});putDefaults(3,3,"protocol");jT.sortColDefs(colDefs);jT.$(theTable).dataTable({"bPaginate":true,"bProcessing":true,"bLengthChange":false,"bAutoWidth":false,"sDom":self.settings.sDom||"rt<Fip>","aoColumns":colDefs,"fnInfoCallback":function(oSettings,iStart,iEnd,iMax,iTotal,sPre){var el=jT.$('.title .data-field',jT.$(this).parents('.jtox-study'))[0];el.innerHTML=self.updateCount(el.innerHTML,iTotal);return sPre;},"oLanguage":{"sProcessing":"<img src='"+(jT.settings.baseUrl||self.baseUrl)+"images/24x24_ambit.gif' border='0'>","sLoadingRecords":"No studies found.","sZeroRecords":"No studies found.","sEmptyTable":"No studies available.","sInfo":"Showing _TOTAL_ study(s) (_START_ to _END_)","sLengthMenu":'Display <select>'+
'<option value="10">10</option>'+
'<option value="20">20</option>'+
'<option value="50">50</option>'+
'<option value="100">100</option>'+
'<option value="-1">all</option>'+
'</select> studies.'}});jT.$(theTable).dataTable().fnAdjustColumnSizing();}
else
jT.$(theTable).dataTable().fnClearTable();return theTable;},processSummary:function(summary){var self=this;var typeSummary=[];jT.$('.jtox-study',self.rootElement).remove();summary.sort(function(a,b){var valA=(a.category.order||a.category.description||a.category.title);var valB=(b.category.order||b.category.description||b.category.title);if(valA==null)
return-1;if(valB==null)
return 1;return(valA<valB)?-1:1;});for(var si=0,sl=summary.length;si<sl;++si){var sum=summary[si];var top=sum.topcategory.title;if(!top)
continue;var top=top.replace(/ /g,"_");var tab=jT.$('.jtox-study-tab.'+top,self.rootElement)[0];var catname=sum.category.title;if(!catname){typeSummary[top]=sum.count;}
else{var cat=self.createCategory(tab,catname);jT.$(cat).data('jtox-uri',sum.category.uri);}}
jT.$('ul li a',self.rootElement).each(function(i){var data=jT.$(this).data('type');if(!!data){var cnt=typeSummary[data];var el=jT.$(this)[0];el.innerHTML=(self.updateCount(el.innerHTML,cnt));}});var filterTimeout=null;var fFilter=function(ev){if(!!filterTimeout)
clearTimeout(filterTimeout);var field=ev.currentTarget;var tab=jT.$(this).parents('.jtox-study-tab')[0];filterTimeout=setTimeout(function(){var tabList=jT.$('.jtox-study-table',tab);for(var t=0,tlen=tabList.length;t<tlen;++t){jT.$(tabList[t]).dataTable().fnFilter(field.value);}},300);};var tabList=jT.$('.jtox-study-tab');for(var t=0,tlen=tabList.length;t<tlen;t++){var filterEl=jT.$('.jtox-study-filter',tabList[t])[0].onkeydown=fFilter;}},processStudies:function(tab,study,map){var self=this;var cats={};if(!map){cats[study[0].protocol.category.code]=study;}
else{for(var i=0,slen=study.length;i<slen;++i){var ones=study[i];if(map){if(cats[ones.protocol.category]===undefined){cats[ones.protocol.category.code]=[ones];}
else{cats[ones.protocol.category.code].push(ones);}}}}
for(var c in cats){var onec=cats[c];var aStudy=jT.$('.'+c+'.jtox-study',tab)[0];if(aStudy===undefined)
continue;ccLib.fillTree(aStudy,{title:onec[0].protocol.category.title+" (0)"});var study={};for(var i=0,cl=onec.length;i<cl;++i){jT.$.extend(true,study,onec[i]);if(!ccLib.isEmpty(study.parameters)&&!ccLib.isEmpty(study.effects[0].conditions))
break;}
var theTable=self.ensureTable(tab,study);jT.$(theTable).dataTable().fnAddData(onec);jT.$(theTable).colResizable({minWidth:30,liveDrag:true});jT.$(theTable).parents('.jtox-study').addClass('folded');}
jT.$('#'+theTable.id+' .jtox-multi').each(function(index){this.style.height=''+this.offsetHeight+'px';});},formatConcentration:function(precision,val,unit){return((precision===undefined||precision===null||"="==precision?"":precision)+val+" "+(unit==null||unit==''?'<span class="units">% (w/w)</span>':unit)).replace(/ /g,"&nbsp;").replace("span&nbsp;","span ");},processComposition:function(json){var self=this;var tab=jT.$('.jtox-composition',self.rootElement)[0];if(jT.$(tab).hasClass('unloaded')){jT.$(tab).removeClass('unloaded');jT.$(tab).empty();}
var prepareFillTable=function(json,panel){var theTable=jT.$('.substances-table',panel);jT.$(theTable).dataTable({"bSearchable":true,"bProcessing":true,"bPaginate":true,"sDom":self.settings.sDom||"rt<Fip>","sPaginate":".dataTables_paginate _paging","bAutoWidth":false,"oLanguage":{"sProcessing":"<img src='"+(jT.settings.baseUrl||self.baseUrl)+"images/24x24_ambit.gif' border='0'>","sLoadingRecords":"No substances found.","sZeroRecords":"No substances found.","sEmptyTable":"No substances available.","sInfo":"Showing _TOTAL_ substance(s) (_START_ to _END_)",},"aoColumns":[{"sClass":"left","sWidth":"10%","mData":"relation","mRender":function(val,type,full){if(type!='display')
return''+val;var func=("HAS_ADDITIVE"==val)?full.proportion.function_as_additive:"";return'<span class="camelCase">'+val.replace("HAS_","").toLowerCase()+'</span>'+((func===undefined||func===null||func=='')?"":" ("+func+")");}},{"sClass":"camelCase left","sWidth":"15%","mData":"component.compound.name","mRender":function(val,type,full){return(type!='display')?''+val:'<a href="'+full.component.compound.URI+'" target="_blank" title="Click to view the compound"><span class="ui-icon ui-icon-link" style="float: left; margin-right: .3em;"></span></a>'+val;}},{"sClass":"left","sWidth":"10%","mData":"component.compound.einecs",},{"sClass":"left","sWidth":"10%","mData":"component.compound.cas",},{"sClass":"center","sWidth":"15%","mData":"proportion.typical","mRender":function(val,type,full){return type!='display'?''+val.value:self.formatConcentration(val.precision,val.value,val.unit);}},{"sClass":"center","sWidth":"15%","mData":"proportion.real","mRender":function(val,type,full){return type!='display'?''+val.lowerValue:self.formatConcentration(val.lowerPrecision,val.lowerValue,val.unit);}},{"sClass":"center","sWidth":"15%","mData":"proportion.real","mRender":function(val,type,full){return type!='display'?''+val.upperValue:self.formatConcentration(val.upperPrecision,val.upperValue,val.unit);}},{"sClass":"center","bSortable":false,"mData":"component.compound.URI","mRender":function(val,type,full){return!val?'':'<a href="'+(jT.settings.baseUrl||self.baseUrl)+'substance?type=related&compound_uri='+encodeURIComponent(val)+'" target="_blank">Also contained in...</span></a>';}}]});jT.$(theTable).dataTable().fnAddData(json);return theTable;};var substances={};jToxCompound.processFeatures(json.feature);for(var i=0,cmpl=json.composition.length;i<cmpl;++i){var cmp=json.composition[i];jToxCompound.processEntry(cmp.component,json.feature,fnDatasetValue);var theSubs=substances[cmp.compositionUUID];if(theSubs===undefined)
substances[cmp.compositionUUID]=theSubs={name:"",purity:"",maxvalue:0,uuid:cmp.compositionUUID,composition:[]};theSubs.composition.push(cmp);var val=cmp.proportion.typical;if(cmp.relation=='HAS_CONSTITUENT'&&(theSubs.maxvalue<val.value||theSubs.name=='')){theSubs.name=cmp.component.compound['name']+' '+self.formatConcentration(val.precision,val.value,val.unit);theSubs.maxvalue=val.value;val=cmp.proportion.real;theSubs.purity=(val.lowerValue+'-'+val.upperValue+' '+(val.unit==null||val.unit==''?'<span class="units">% (w/w)</span>':val.unit)).replace(/ /g,"&nbsp;").replace("span&nbsp;","span ");}}
for(var i in substances){var panel=jT.getTemplate('#jtox-compoblock');tab.appendChild(panel);ccLib.fillTree(jT.$('.composition-info',panel)[0],substances[i]);prepareFillTable(substances[i].composition,panel);}},querySummary:function(summaryURI){var self=this;jT.call(self,summaryURI,function(summary){if(!!summary&&!!summary.facet)
self.processSummary(summary.facet);if(!!self.settings.tab){var div=jT.$('.jtox-study-tab.'+decodeURIComponent(self.settings.tab).replace(/ /g,'_'),self.root)[0];if(!!div){for(var idx=0,cl=div.parentNode.children.length;idx<cl;++idx)
if(div.parentNode.children[idx].id==div.id)
break;--idx;jT.$(self.tabs).tabs('option','active',idx);jT.$(self.tabs).tabs('option','selected',idx);}}});},queryComposition:function(compositionURI){var self=this;jT.call(self,compositionURI,function(composition){if(!!composition&&!!composition.composition)
self.processComposition(composition);});},querySubstance:function(substanceURI){var self=this;self.baseUrl=ccLib.isNull(self.settings.baseUrl)?jT.grabBaseUrl(substanceURI):self.settings.baseUrl;var rootTab=jT.$('.jtox-substance',self.rootElement)[0];jT.call(self,substanceURI,function(substance){if(!!substance&&!!substance.substance&&substance.substance.length>0){substance=substance.substance[0];substance["showname"]=substance.publicname||substance.name;var flags='';for(var i=0,iLen=substance.externalIdentifiers.length;i<iLen;++i){if(i>0)
flags+=', ';flags+=substance.externalIdentifiers[i].id||'';}
substance["IUCFlags"]=flags;ccLib.fillTree(self.rootElement,substance);jT.call(self,substance.referenceSubstance.uri,function(dataset){if(!!dataset){jToxCompound.processDataset(dataset,null,fnDatasetValue);ccLib.fillTree(rootTab,dataset.dataEntry[0]);}});self.querySummary(substance.URI+"/studysummary");self.queryComposition(substance.URI+"/composition");}});}};return cls;})();window.jT=window.jToxKit={templateRoot:null,queries:{taskPoll:{method:'GET',service:"/task/{id}"},},templates:{},tools:{},settings:{plainText:false,jsonp:false,crossDomain:false,baseUrl:null,fullUrl:null,timeout:15000,pollDelay:200,onConnect:function(s){},onSuccess:function(s,c,m){},onError:function(s,c,m){if(!!console&&!!console.log)console.log("jToxKit call error ("+c+"): "+m+" from request: ["+s+"]");},},formBaseUrl:function(url){return!!url.host?url.protocol+"://"+url.host+(url.port.length>0?":"+url.port:'')+'/'+url.segments[0]:null;},initKit:function(element){var self=this;var dataParams=self.$(element).data();if(!dataParams.manualInit){var kit=dataParams.kit;var topSettings=self.$.extend(true,{},self.settings);self.$(self.$(element).parents('.jtox-toolkit').toArray().reverse()).each(function(){if(!self.$(this).hasClass('jtox-widget')){topSettings=self.$.extend(true,topSettings,self.$(this).data());}});dataParams=self.$.extend(true,topSettings,dataParams);var realInit=function(params){if(!kit)
return null;if(!window[kit]&&kit.indexOf('jTox')!=0)
kit='jTox'+kit.charAt(0).toUpperCase()+kit.slice(1);var fn=window[kit];if(typeof fn=='function'){var obj=new fn(element,params);if(fn.kits===undefined)
fn.kits=[];fn.kits.push(obj);return obj;}
else if(typeof fn=="object"&&typeof fn.init=="function")
return fn.init(element,params);else
console.log("jToxError: trying to initialize unexistend jTox kit: "+kit);return null;};if(!ccLib.isNull(dataParams.configFile)){self.call({settings:dataParams},dataParams.configFile,function(config){if(!!config)
dataParams['configuration']=self.$.extend(true,dataParams['configuration'],config);jT.$(element).data('jtKit',realInit(dataParams));});}
else{if(!ccLib.isNull(dataParams.configuration)&&typeof dataParams.configuration=="string"&&!ccLib.isNull(window[dataParams.configuration]))
dataParams.configuration=window[dataParams.configuration];jT.$(element).data('jtKit',realInit(dataParams));}}},init:function(root){var self=this;if(!root){self.initTemplates();self.$(document).on('click','.jtox-toolkit span.ui-icon-copy',function(){ccLib.copyToClipboard(self.$(this).data('uuid'));return false;});self.$(document).on('click','.jtox-foldable>.title',function(){self.$(this).parent().toggleClass('folded');});var url=self.settings.fullUrl=ccLib.parseURL(document.location);var queryParams=url.params;if(!queryParams.baseUrl)
queryParams.baseUrl=self.formBaseUrl(url);self.settings=self.$.extend(true,self.settings,queryParams);root=document;}
self.$('.jtox-toolkit',root).each(function(i){self.initKit(this);});},kit:function(element){return $(element).data('jtKit');},parentKit:function(name,element){var query=null;if(typeof name=='string')
name=window[name];self.$(element).parents('.jtox-toolkit').each(function(){var kit=jT.kit(this);if(!kit)
return;if(kit instanceof name)
query=kit;});return query;},initTemplates:function(){var self=this;var root=jT.$('.jtox-template')[0];if(!root){root=document.createElement('div');root.className='jtox-template';document.body.appendChild(root);}
var html=root.innerHTML;for(var t in self.templates){html+=self.templates[t];}
root.innerHTML=html;self.templateRoot=root;},getTemplate:function(selector){var el=jT.$(selector,this.templateRoot)[0];if(!!el){var el=el.cloneNode(true);el.removeAttribute('id');}
return el;},insertTool:function(name,root){var html=this.tools[name];if(!ccLib.isNull(html)){root.innerHTML=html;this.init(root);}
return root;},changeTabsIds:function(root,suffix){jT.$('ul li a',root).each(function(){var id=jT.$(this).attr('href').substr(1);var el=document.getElementById(id);id+=suffix;el.id=id;jT.$(this).attr('href','#'+id);})},modifyColDef:function(kit,col,category,group){var name=col.sTitle.toLowerCase();var getColDef=function(cat){var catCol=kit.settings.configuration.columns[cat];if(!ccLib.isNull(catCol)){if(!!group){catCol=catCol[group];if(!ccLib.isNull(catCol))
catCol=catCol[name];}
else
catCol=catCol[name];}
if(ccLib.isNull(catCol))
catCol={};return catCol;};col=this.$.extend(col,(!!group?getColDef('_'):{}),getColDef(category));return ccLib.isNull(col.bVisible)||col.bVisible?col:null;},sortColDefs:function(colDefs){colDefs.sort(function(a,b){var valA=ccLib.isNull(a.iOrder)?0:a.iOrder;var valB=ccLib.isNull(b.iOrder)?0:b.iOrder;return valA-valB;});},processColumns:function(kit,category){var colDefs=[];var catList=kit.settings.configuration.columns[category];for(var name in catList){var col=this.modifyColDef(kit,catList[name],category);if(col!=null)
colDefs.push(col);}
this.sortColDefs(colDefs);return colDefs;},shortenedData:function(data,message,deflen){var res='';if(ccLib.isNull(deflen))
deflen=5;if(data.toString().length<=deflen){res+=data;}
else{res+='<div class="shortened">'+data+'</div>';if(message!=null)
res+='<span class="ui-icon ui-icon-copy" title="'+message+'" data-uuid="'+data+'"></span>';}
return res;},pollTask:function(kit,task,callback){var self=this;if(task===undefined||task.task===undefined||task.task.length<1){console.log("Wrong task passed for polling: "+JSON.stringify(task));return;}
task=task.task[0];ccLib.fireCallback(callback,kit,task);if(task.completed==-1){setTimeout(function(){self.call(kit,task.result,function(newTask){self.pollTask(newTask,callback);});},self.pollDelay);}
else if(task.error){ccLib.fireCallback(self.settings.onError,self,'-1',task.error);}},grabBaseUrl:function(url){if(!ccLib.isNull(url)&&url.indexOf('http')==0)
return this.formBaseUrl(ccLib.parseURL(url));else
return this.settings.baseUrl;},call:function(kit,service,params,callback){if(typeof params!='object'){callback=params;params={};}
else if(params==null)
params={};var settings=jT.$.extend({},this.settings,params);if(kit==null)
kit=this;else
settings=jT.$.extend(settings,kit.settings);ccLib.fireCallback(settings.onConnect,kit,service);var accType=settings.plainText?"text/plain":(settings.jsonp?"application/x-javascript":"application/json");if(!params.data){params.data={};if(settings.jsonp)
params.data.media=accType;if(!params.method)
params.method='GET';}
else if(!params.method)
params.method='POST';if(service.indexOf("http")!=0)
service=settings.baseUrl+service;jT.$.ajax(service,{dataType:params.dataType||(settings.plainText?"text":(settings.jsonp?'jsonp':'json')),headers:{Accept:accType},crossDomain:settings.crossDomain||settings.jsonp,timeout:settings.timeout,type:params.method,data:params.data,jsonp:settings.jsonp?'callback':false,error:function(jhr,status,error){ccLib.fireCallback(settings.onError,kit,service,status,error);callback(null,jhr);},success:function(data,status,jhr){ccLib.fireCallback(settings.onSuccess,kit,service,status,jhr.statusText);callback(data,jhr);}});}};jT.$=jQuery;jT.$(document).ready(function(){jT.init();});jT.templates['widget-search']="    <div id=\"jtox-search\" class=\"jtox-search\">"+
"      <form>"+
"  	  	<div class=\"jq-buttonset jtox-inline\">"+
"  			  <input type=\"radio\" id=\"searchauto\" value=\"auto\" name=\"searchtype\" checked=\"checked\" data-placeholder=\"Enter CAS, EINECS, Chemical name, SMILES or InChI_\">"+
"  			    <label for=\"searchauto\" title=\"Exact structure or search by an identifier. CAS, Chemical name, SMILES or InChI. The input type is guessed automatically.\">Exact structure</label>"+
"          </input>"+
"  			  <input type=\"radio\" id=\"searchsimilarity\" value=\"similarity\" name=\"searchtype\" data-placeholder=\"Enter Chemical name, SMILES or InChI_\">"+
"  			    <label for=\"searchsimilarity\" title=\"Enter SMILES or draw structure\">Similarity</label>"+
"          </input>"+
"  			  <input type=\"radio\" id=\"searchsmarts\" value=\"smarts\" name=\"searchtype\" data-placeholder=\"Enter SMARTS_\">"+
"  			    <label for=\"searchsmarts\" title=\"Enter or draw a SMARTS query\">Substructure</label>"+
"          </input>"+
"  			</div>"+
"    		<div class=\"jtox-inline float-right search-pane\">"+
"  			  <div class=\"dynamic searchsimilarity hidden jtox-inline\">"+
"      			<select name='threshold' title ='Tanimoto similarity threshold'>"+
"    					<option value='0.9' selected=\"selected\">0.9</option>"+
"  			   		<option value='0.8' >0.8</option>"+
"  			   		<option value='0.7' >0.7</option>"+
"  			   		<option value='0.6' >0.6</option>"+
"  			   		<option value='0.5' >0.5</option>"+
"  			   		<option value='0.4' >0.4</option>"+
"  			   		<option value='0.3' >0.3</option>"+
"  			   		<option value='0.2' >0.2</option>"+
"  			   		<option value='0.1' >0.1</option>"+
"      			</select>	"+
"  			  </div>"+
"  			  <div class=\"dynamic searchsmarts hidden jtox-inline\">"+
"  			    <select name=\"smarts\" title =\"Predefined functional groups\"></select>"+
"  			  </div>"+
"  			  <div class=\"jtox-inline\">"+
"            <input type=\"text\" name=\"searchbox\" class=\"jtox-handler\"/>"+
"            <button name=\"searchbutton\" class=\"jtox-handler\" title=\"Search/refresh\" data-handler=\"query\"><span class=\"ui-icon ui-icon-search\"/></button>"+
"            <button name=\"drawbutton\" title=\"Draw the (sub)structure\"><span class=\"ui-icon ui-icon-pencil\"/></button>"+
"  			  </div>"+
"    		</div>"+
"      </form>"+
"      <div class=\"ketcher shrinken\"></div>"+
"    </div>"+
"";jT.templates['ketcher-buttons']="    <button id=\"ketcher-usebutton\">Use <span class=\"ui-icon ui-icon-arrowthick-1-n\"></span></button>"+
"    <button id=\"ketcher-drawbutton\">Draw <span class=\"ui-icon ui-icon-arrowthick-1-s\"></span></button>"+
"";jT.templates['all-compound']="	  <div id=\"jtox-compound\">"+
"	    <div class=\"jtox-ds-features\"></div>"+
"	    <div class=\"jtox-ds-control\">"+
"	      Showing from <span class=\"data-field from-field\" data-field=\"pagestart\"> ? </span> to <span class=\"data-field\" data-field=\"pageend\"> ? </span> in pages of <select class=\"data-field\" data-field=\"pagesize\">"+
"          <option value=\"10\" selected=\"yes\">10</option>"+
"          <option value=\"20\">20</option>"+
"          <option value=\"50\">50</option>"+
"          <option value=\"100\">100</option>"+
"          <option value=\"200\">200</option>"+
"          <option value=\"500\">500</option>"+
"        </select> entries"+
"	      <a class=\"paginate_disabled_previous prev-field\" tabindex=\"0\" role=\"button\">Previous</a><a class=\"paginate_enabled_next next-field\" tabindex=\"0\" role=\"button\">Next</a>"+
"	      <input type=\"text\" class=\"filterbox\" placeholder=\"Filter...\" />"+
"	    </div>"+
"	    <div class=\"jtox-ds-tables\">"+
"	      <div class=\"jtox-ds-fixed\">"+
"	        <table></table>"+
"	      </div><div class=\"jtox-ds-variable\">"+
"	        <table></table>"+
"	      </div>"+
"	    </div>"+
"	  </div>"+
"";jT.templates['compound-one-feature']="    <div id=\"jtox-ds-feature\" class=\"jtox-ds-feature\"><input type=\"checkbox\" checked=\"yes\" class=\"jtox-checkbox\" /><span class=\"data-field jtox-title\" data-field=\"title\"> ? </span><sup><a target=\"_blank\" class=\"data-field attribute\" data-attribute=\"href\" data-field=\"uri\">?</a></sup></div>"+
"";jT.templates['compound-download']="    <div id=\"jtox-ds-download\" class=\"jtox-inline jtox-ds-download\">"+
"      <a target=\"_blank\"><img class=\"borderless\"/></a>"+
"    </div>"+
"";jT.templates['compound-export']="    <div id=\"jtox-ds-export\">"+
"      <div class=\"jtox-inline\">Download dataset as: </div>"+
"      <div class=\"jtox-inline jtox-exportlist\"></div>"+
"    </div>"+
"";jT.templates['compound-one-detail']="    <table>"+
"      <tbody>"+
"        <tr id=\"jtox-one-detail\">"+
"          <th class=\"right\"><span class=\"data-field\" data-field=\"title\"> ? </span><sup><a target=\"_blank\" class=\"data-field attribute\" data-attribute=\"href\" data-field=\"uri\">?</a></sup></th>"+
"          <td class=\"left data-field\" data-field=\"value\"> ? </td>"+
"        </tr>"+
"      </tbody>"+
"    </table>"+
"";jT.templates['compound-details-table']="    <table id=\"jtox-details-table\" class=\"jtox-details-table\"></table>"+
"";jT.templates['all-dataset']="	  <div id=\"jtox-dataset\">"+
"      <table></table>"+
"	  </div>"+
"";jT.templates['all-model']="	  <div id=\"jtox-model\">"+
"      <table></table>"+
"	  </div>"+
"";jT.templates['all-studies']="	  <div id=\"jtox-studies\">"+
"	    <ul>"+
"	      <li><a href=\"#jtox-substance\">IUC Substance</a></li>"+
"	      <li><a href=\"#jtox-composition\">Composition</a></li>"+
"	      <li><a href=\"#jtox-pchem\" data-type=\"P-CHEM\">P-Chem (0)</a></li>"+
"	      <li><a href=\"#jtox-envfate\" data-type=\"ENV_FATE\">Env Fate (0)</a></li>"+
"	      <li><a href=\"#jtox-ecotox\" data-type=\"ECOTOX\">Eco Tox (0)</a></li>"+
"	      <li><a href=\"#jtox-tox\" data-type=\"TOX\">Tox (0)</a></li>"+
"	    </ul>"+
"	    <div id=\"jtox-substance\" class=\"jtox-substance\">"+
"	      <table class=\"dataTable\">"+
"	        <thead>"+
"	          <tr>"+
"	            <th class=\"right size-third\">IUC Substance name:</th>"+
"	            <td class=\"data-field camelCase\" data-field=\"name\"> ? </td>"+
"	          </tr>"+
"	          <tr>"+
"	            <th class=\"right\">IUC Substance UUID:</th>"+
"	            <td class=\"data-field\" data-field=\"i5uuid\"> ? </td>"+
"	          </tr>"+
"	          <tr>"+
"	            <th class=\"right\">IUC Public name:</th>"+
"	            <td class=\"data-field camelCase\" data-field=\"publicname\"> ? </td>"+
"	          </tr>"+
"	          <tr>"+
"	            <th class=\"right\">Legal entity:</th>"+
"	            <td class=\"data-field\" data-field=\"ownerName\"> ? </td>"+
"	          </tr>"+
"	          <tr>"+
"	            <th class=\"right\">Legal entity UUID:</th>"+
"	            <td class=\"data-field\" data-field=\"ownerUUID\"> ? </td>"+
"	          </tr>"+
"	          <tr>"+
"	            <th class=\"right\">Type substance composition:</th>"+
"	            <td class=\"data-field\" data-field=\"substanceType\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-bottom\">"+
"	            <th class=\"right\">IUC Substance Reference Identifier</th>"+
"	            <td></td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top borderless-bottom\">"+
"	            <td class=\"right\">CAS:</td>"+
"	            <td class=\"data-field\" data-field=\"compound.cas\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top borderless-bottom\">"+
"	            <td class=\"right\">EC:</td>"+
"	            <td class=\"data-field\" data-field=\"compound.einecs\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top borderless-bottom\">"+
"	            <td class=\"right\">Chemical name:</td>"+
"	            <td class=\"data-field\" data-field=\"compound.name\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top borderless-bottom\">"+
"	            <td class=\"right\">IUPAC name:</td>"+
"	            <td class=\"data-field\" data-field=\"compound.iupac\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top borderless-bottom\">"+
"	            <td class=\"right\">UUID:</td>"+
"	            <td class=\"data-field\" data-field=\"referenceSubstance.i5uuid\"> ? </td>"+
"	          </tr>"+
"	          <tr class=\"borderless-top\">"+
"	            <td class=\"right\">IUC Flags:</td>"+
"	            <td class=\"data-field\" data-field=\"IUCFlags\"> ? </td>"+
"	          </tr>"+
"	        </thead>"+
"	      </table>"+
"	    </div>"+
"	    <div id=\"jtox-composition\" class=\"jtox-composition unloaded\"></div>"+
"	    <div id=\"jtox-pchem\" class=\"jtox-study-tab P-CHEM\">"+
"	    	<div class=\"float-right\">"+
"	      	<button class=\"expand-all\">Expand all</button><button class=\"collapse-all\">Collapse all</button>"+
"	    	</div>"+
"	      <p><input type=\"text\" class=\"jtox-study-filter ui-input\" placeholder=\"Filter...\" /></p>"+
"	      <h4 class=\"data-field camelCase\" data-field=\"showname\"> ? </h4>"+
"      </div>"+
"	    <div id=\"jtox-envfate\" class=\"jtox-study-tab ENV_FATE\">"+
"	    	<div class=\"float-right\">"+
"	      	<button class=\"expand-all\">Expand all</button><button class=\"collapse-all\">Collapse all</button>"+
"	    	</div>"+
"	      <p><input type=\"text\" class=\"jtox-study-filter ui-input\" placeholder=\"Filter...\" /></p>"+
"	      <h4 class=\"data-field camelCase\" data-field=\"showname\"> ? </h4>"+
"	    </div>"+
"	    <div id=\"jtox-ecotox\" class=\"jtox-study-tab ECOTOX\">"+
"	    	<div class=\"float-right\">"+
"	      	<button class=\"expand-all\">Expand all</button><button class=\"collapse-all\">Collapse all</button>"+
"	    	</div>"+
"	      <p><input type=\"text\" class=\"jtox-study-filter ui-input\" placeholder=\"Filter...\" /></p>"+
"	      <h4 class=\"data-field camelCase\" data-field=\"showname\"> ? </h4>"+
"	    </div>"+
"	    <div id=\"jtox-tox\" class=\"jtox-study-tab TOX\">"+
"	    	<div class=\"float-right\">"+
"	      	<button class=\"expand-all\">Expand all</button><button class=\"collapse-all\">Collapse all</button>"+
"	    	</div>"+
"	      <p><input type=\"text\" class=\"jtox-study-filter ui-input\" placeholder=\"Filter...\" /></p>"+
"	      <h4 class=\"data-field camelCase\" data-field=\"showname\"> ? </h4>"+
"	    </div>"+
"	  </div>"+
"";jT.templates['composition-block']="    <div id=\"jtox-compoblock\" class=\"jtox-compoblock\">"+
"      <table class=\"dataTable composition-info font-small\">"+
"        <thead>"+
"          <tr><th>Composition name:</th><td class=\"data-field camelCase\" data-field=\"name\"> ? </td></tr>"+
"          <tr><th>Composition UUID:</th><td class=\"data-field\" data-field=\"uuid\"> ? </td></tr>"+
"          <tr><th>Purity of IUC Substance:</th><td class=\"data-field\" data-field=\"purity\"> ? </td></tr>"+
"        </thead>"+
"      </table>"+
"      <table class=\"substances-table\">"+
"        <thead>"+
"          <tr>"+
"            <th>Type</th>"+
"            <th>Name</th>"+
"            <th>EC No.</th>"+
"            <th>CAS No.</th>"+
"            <th>Typical concentration</th>"+
"            <th colspan=\"2\">Concentration ranges</th>"+
"            <th></th>"+
"          </tr>"+
"        </thead>"+
"      </table>"+
"    </div>"+
"";jT.templates['one-study']="    <div id=\"jtox-study\" class=\"jtox-study jtox-foldable folded unloaded\">"+
"      <div class=\"title\"><p class=\"data-field\" data-field=\"title\">? (0)</p></div>"+
"      <div class=\"content\">"+
"        <table class=\"jtox-study-table content\"></table>"+
"      </div>"+
"    </div>"+
"";